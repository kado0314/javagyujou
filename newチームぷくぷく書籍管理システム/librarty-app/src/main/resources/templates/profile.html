<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>プロフィール画面</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <header class="header">
        <h1><a th:href="@{/home_post}">ぷくぷくBOOKS</a></h1> 
        <div class="nav-links">
            </div>
    </header>

    <div class="container">
        <h2>ようこそ、<span th:text="${user.nickname}">ユーザー名</span>さん</h2>

        <div th:if="${successMessage}" class="message success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="message error" th:text="${errorMessage}"></div>

        <div class="profile-summary">
            <h3>現在の貸出状況</h3>
            <div class="loan-status">
                <span th:text="${currentLoans}">X</span> / <span th:text="${maxLoans}">3</span> 冊
            </div>
            <p>現在貸し出し中 (最大<span th:text="${maxLoans}">3</span>冊まで)</p>
        </div>

        <h3>登録情報</h3>
        <table class="data-table">
            <tr>
                <th>ニックネーム</th>
                <td th:text="${user.nickname}"></td>
            </tr>
            <tr>
                <th>メールアドレス</th>
                <td th:text="${user.email}"></td>
            </tr>
            <tr>
                <th>電話番号</th>
                <td th:text="${user.phone}"></td>
            </tr>
            <tr>
                <th>住所</th>
                <td th:text="${user.zipcode} + ' ' + ${user.address}"></td>
            </tr>
        </table>

        <a th:href="@{/profile/edit}" class="btn-primary btn-edit-profile">プロフィールを編集</a>
        
        <hr class="separator">

        <h3>貸出中の書籍</h3>
        
        <div th:if="${#lists.isEmpty(borrowedBooks)}">
            <p>現在、貸出中の書籍はありません。</p>
        </div>

        <div th:unless="${#lists.isEmpty(borrowedBooks)}">
            <div th:each="loan : ${borrowedBooks}" class="loaned-book-card">
                <div>
                    <p><strong>書籍ID:</strong> <span th:text="${loan.bookId}"></span></p>
                    <p><strong>貸出日:</strong> <span th:text="${loan.loanday}"></span></p>
                    <p><strong>返却予定日:</strong> <span th:text="${loan.SReturn}"></span></p>
                </div>
                
                <form th:action="@{/return}" method="post">
                    <input type="hidden" name="loanId" th:value="${loan.id}" />
                    <button type="submit" class="btn-primary btn-return">返却する</button>
                </form>
            </div>
        </div>
        
        <hr class="separator">

        </div>
</body>
</html>